<div x-data="itemFilterSystem" class="db-container glow-items">
  <div class="db-title">Items</div>
  <div class="db-content">
    <div class="data-menu">
      <div class="search-container">
        <svg
          class="w-4 h-4 text-white/20 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          ></path>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Search..."
          x-model.debounce.200ms="search_term"
        />
        <button
          class="search-clear-btn"
          x-show="search_term != ''"
          @click="search_term=''"
        >
          âœ•
        </button>
      </div>

      <div class="filter-container">
        <button
          type="button"
          class="filter-toggle-btn"
          @click="filter_open = !filter_open"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-[#e63946]"
          >
            <polygon
              points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"
            ></polygon>
          </svg>
          Filter
        </button>

        <div
          class="filter-content"
          x-show="filter_open"
          @click.away="filter_open = false"
          x-cloak
        >
          <div class="filter-category">
            <h4 class="filter-category-title">Rarity</h4>
            <ul class="filter-category-list">
              <template x-for="rarity in rarities" :key="rarity">
                <li>
                  <button
                    type="button"
                    class="filter-chip"
                    :class="selected_rarities.includes(rarity) ? 'is_active' : ''"
                    @click="toggle_rarity(rarity)"
                    x-text="rarity"
                  ></button>
                </li>
              </template>
            </ul>
          </div>
          <div class="filter-category">
            <h4 class="filter-category-title">Type</h4>
            <ul class="filter-category-list grid-style">
              <template x-for="category in categories" :key="category">
                <li>
                  <button
                    type="button"
                    class="filter-chip"
                    :class="selected_categories.includes(category) ? 'is_active' : ''"
                    @click="toggle_category(category)"
                    x-text="category"
                  ></button>
                </li>
              </template>
            </ul>

            <button
              type="button"
              @click="clear_filters()"
              class="clear-filters-btn"
            >
              Clear All Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="data-grid">
      {% for id, item in items.items() %}
      <div
        class="data-item {{ item.Rarity }} {{ item.Class }}"
        data-name="{{ item.Name|lower }}"
      >
        <div class="data-card">
          <div class="data-img-container bg-{{ item.Rarity|lower }}">
            <img
              src="{{ item.Image if item.Image else 'http://placehold.co/120x120' }}"
              alt="{{ item.Name }}"
              loading="lazy"
            />
          </div>
          <span class="data-name">{{ item.Name }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
